# Модули

---

### ЦЕЛИ ЭКЗАМЕНА OCP, ОПИСАННЫЕ В ЭТОЙ ГЛАВЕ:

#### Упаковка и развертывание кода Java и использование системы модулей платформы Java

+ Определите модули и их зависимости, выставьте содержимое модулей, в том числе для отражения. Определите услуги, 
производителей и потребителей
+ Компилируйте код Java, создавайте модульные и немодульные jar-файлы, образы среды выполнения и реализуйте миграцию с 
использованием безымянных и автоматических модулей

---

Пакеты можно группировать в модули. В этой главе мы объясняем назначение модулей и способы создания собственных. Мы 
также покажем, как их запускать и как обнаруживать существующие модули. Далее мы рассмотрим стратегии миграции 
приложения на использование модулей, запуск частично модульного приложения и работу с зависимостями. Затем мы переходим 
к обсуждению сервисов и локаторов сервисов. Наконец, мы покажем, как создать образ времени выполнения.

Мы разместили код из этой главы в Интернете. Поскольку создание структуры каталогов может оказаться утомительным, это 
сэкономит вам некоторое время. Кроме того, команды должны быть абсолютно правильными, поэтому мы включили их в Интернет, 
чтобы вы могли скопировать и вставить их и сравнить с тем, что вы набрали. Оба доступны в нашем репозитории GitHub, 
ссылка на который находится на 

```
www.selikoff.net/ocp-17/
```

## Знакомство с модулями

При написании кода для экзамена вы обычно видите небольшие классы. В конце концов, экзаменационные вопросы должны 
умещаться на одном экране! Когда вы работаете над реальными программами, они намного больше. Реальный проект будет 
состоять из сотен или тысяч классов, сгруппированных в пакеты. Эти пакеты сгруппированы в файлы архива Java (JAR). 
JAR — это ZIP-файл с дополнительной информацией, имеющий расширение .jar.

Помимо кода, написанного вашей командой, большинство приложений также используют код, написанный другими. Открытый 
исходный код — это программное обеспечение с поставляемым кодом, которое часто можно использовать бесплатно. Java имеет 
активное сообщество программного обеспечения с открытым исходным кодом (OSS), и эти библиотеки также поставляются в 
виде файлов JAR. Например, есть библиотеки для чтения файлов, подключения к базе данных и многое другое.

Некоторые проекты с открытым исходным кодом даже зависят от функциональности других проектов с открытым исходным кодом. 
Например, Spring — это широко используемая среда, а JUnit — широко используемая библиотека тестирования. Чтобы 
использовать любой из них, вам необходимо убедиться, что у вас есть совместимые версии всех соответствующих JAR-файлов, 
доступных во время выполнения. Эту сложную цепочку зависимостей и минимальных версий сообщество часто называет JAR-адом. 
Ад — отличный способ описать неправильную версию загружаемого класса или даже исключение ClassNotFoundException во 
время выполнения.

Система модулей платформы Java (JPMS) группирует код на более высоком уровне. Основная цель модуля — предоставить 
группы связанных пакетов, которые предлагают разработчикам определенный набор функций. Это похоже на файл JAR, за 
исключением того, что разработчик выбирает, какие пакеты доступны вне модуля. Давайте разберемся, что такое модули и 
какие задачи они призваны решать.

Система модулей платформы Java включает в себя следующее:

+ Формат для JAR-файлов модуля
+ Разбиение JDK на модули
+ Дополнительные параметры командной строки для инструментов Java


### Изучение модуля

В главе 1 «Строительные блоки» у нас было небольшое приложение Zoo. У него был только один класс, и он распечатывал 
только одну вещь. А теперь представьте, что у нас есть целый штат программистов и мы автоматизируем работу зоопарка. 
Многие вещи необходимо закодировать, в том числе взаимодействие с животными, посетителями, общедоступным веб-сайтом и 
информационно-просветительской деятельностью.

Модуль — это группа из одного или нескольких пакетов плюс специальный файл под названием Module-info.java. Содержимое 
этого файла является объявлением модуля. На рисунке 12.1 перечислены лишь некоторые из модулей, которые могут 
понадобиться зоопарку. В нашем примере мы решили сосредоточиться на взаимодействии животных. Полный зоопарк легко мог 
бы состоять из дюжины модулей. Обратите внимание, что на рисунке 12.1 между многими модулями есть стрелки. Они 
представляют собой зависимости, когда один модуль использует код другого. Персоналу необходимо кормить животных, чтобы 
сохранить свою работу. Строка от zoo.staff до zoo.animal.feeding показывает, что первое зависит от второго.

#### Рис. 12.1 - Проектирование модульной системы


Теперь давайте углубимся в один из этих модулей. На рис. 12.2 показано, что находится внутри модуля zoo.animal.talks. 
Есть три пакета по два класса в каждом. (Это небольшой зоопарк.) Еще есть странный файл под названием module-info.java. 
Этот файл должен находиться внутри всех модулей. Мы объясним это более подробно далее в этой главе.

#### Рис. 12.2 - Заглядываем внутрь модуля


### Преимущества модулей

Модули выглядят как еще один уровень того, что вам нужно знать для программирования. Хотя использование модулей не 
является обязательным, важно понимать проблемы, для решения которых они предназначены:

+ **Улучшенный контроль доступа:** В дополнение к уровням контроля доступа, описанным в главе 5 “Методы”, у вас могут 
быть пакеты, доступные только для других пакетов в модуле.
+ **Более четкое управление зависимостями:** Поскольку модули определяют, на что они полагаются, Java может жаловаться 
на отсутствие JAR при запуске программы, а не при первом обращении к ней во время выполнения.
+ **Пользовательские сборки Java:** Вы можете создать среду выполнения Java, содержащую только те части JDK, которые 
нужны вашей программе, а не полный пакет объемом более 150 МБ.
+ **Улучшенная безопасность:** поскольку вы можете исключить части JDK из своей пользовательской сборки, вам не нужно 
беспокоиться об уязвимостях, обнаруженных в части, которую вы не используете.
+ **Улучшенная производительность:** Еще одним преимуществом меньшего размера Java-пакета является увеличение времени 
запуска и снижение требований к памяти.
+ **Уникальное применение пакетов:** Поскольку модули определяют открытые пакеты, Java может гарантировать, что каждый 
пакет поступает только из одного модуля, и избежать путаницы в отношении того, что запускается.


## Создание и запуск модульной программы

В этом разделе мы создаем, компонуем и запускаем модуль zoo.animal.feeding. Мы выбрали этот модуль для начала, потому 
что от него зависят все остальные модули. Фигура на рис. 12.3 показана конструкция этого модуля. В дополнение к 
module-info.java файл, в нем есть один пакет с одним классом внутри.

#### Рис. 12.3 - Содержание zoo.animal.feeding



В следующих разделах мы создадим, скомпилируем, запустим и упакуем модуль zoo.animal.feeding.

### Создание файлов

